## âœ¨ `useOptimistic`

> âš ï¸ CANARY!

- í•´ë‹¹ ê¸°ëŠ¥ì€ ì•„ì§ Reactì˜ Canary/Experimental ì±„ë„ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.

### ğŸ“‘ Summary

`Optimistic`: "ë‚™ê´€ì ì¸, ì•ìœ¼ë¡œì˜ ì¼ ë”°ìœ„ê°€ ì˜ ë˜ì–´ ê°ˆ ê²ƒìœ¼ë¡œ ì—¬ê¸°ëŠ”" ì´ë¼ëŠ” ëœ»ì„ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.

`useOptimistic`ì€ `React Hook`ìœ¼ë¡œ, ë¹„ë™ê¸° ì‘ì—…ì´ ì§„í–‰ ì¤‘ì¼ ë•Œ ë‹¤ë¥¸ ìƒíƒœë¥¼ ë³´ì—¬ì¤„ ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.

ì´ ìƒíƒœëŠ” â€œë‚™ê´€ì â€ ìƒíƒœë¼ê³  ë¶ˆë¦¬ëŠ”ë°, ì‹¤ì œë¡œ ì‘ì—…ì„ ì™„ë£Œí•˜ëŠ” ë° ì‹œê°„ì´ ê±¸ë¦¬ë”ë¼ë„ ì‚¬ìš©ìì—ê²Œ ì¦‰ì‹œ ì‘ì—…ì˜ ê²°ê³¼ë¥¼ í‘œì‹œí•˜ê¸° ìœ„í•´ ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.

```typescript
const [optimisticState, addOptimistic] = useOptimistic(state, (currentState, optimisticValue) => {});
```

### ğŸ¤” ì–´ë–»ê²Œ ì‘ë™ í• ê¹Œìš”?

ì¼ë¶€ ìƒíƒœ(state)ë¥¼ ì¸ìˆ˜ë¡œ ë°›ì•„ë“¤ì—¬ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ê³¼ ê°™ì€ ë¹„ë™ê¸° ì‘ì—…ì´ ì§„í–‰ë˜ëŠ” ë™ì•ˆ ë‹¤ë£° ìˆ˜ ìˆëŠ” í•´ë‹¹ ìƒíƒœì˜ ë³µì‚¬ë³¸ì„ ë°˜í™˜í•©ë‹ˆë‹¤.

í˜„ì¬ ìƒíƒœì™€ ì‘ì—…ì— ëŒ€í•œ ì…ë ¥ì„ ê°€ì ¸ì™€ ì‘ì—…ì´ ë³´ë¥˜ ì¤‘ì¸ ë™ì•ˆ ì‚¬ìš©í•  ë‚™ê´€ì  ìƒíƒœë¥¼ ì ìš©í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.

ì´ë¥¼ í†µí•´ ì‚¬ìš©ìê°€ ì–‘ì‹ì„ ì œì¶œí•˜ë©´ ì„œë²„ì˜ ì‘ë‹µì´ ë³€ê²½ ì‚¬í•­ì„ ë°˜ì˜í•  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” ëŒ€ì‹  ê²°ê³¼ê°€ ì¦‰ì‹œ ì¸í„°í˜ì´ìŠ¤ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.

> Return Values

| Return Values     | Detail                                                                                                                      |
| :---------------- | :-------------------------------------------------------------------------------------------------------------------------- |
| `optimisticState` | - ë‚™ê´€ì ì¸ ìƒíƒœì˜ ê²½ìš° `updateFn`ì—ì„œ ë°˜í™˜ëœ ê°’ê³¼ ë™ì¼í•©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šì„ ê²½ìš° `state`ì™€ ë™ì¼í•©ë‹ˆë‹¤.                        |
| `addOptimistic`   | - ë‚™ê´€ì ì¸ ì—…ë°ì´íŠ¸ê°€ ìˆì„ ê²½ìš° í˜¸ì¶œí•˜ëŠ” ë””ìŠ¤íŒ¨ì¹˜ í•¨ìˆ˜ì…ë‹ˆë‹¤. updateFnì˜ ë‘ ë²ˆì§¸ ë§¤ê°œë³€ìˆ˜ë¡œ ë„£ì–´ì¤„ ê°’ì„ ë„˜ê²¨ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. |

> Parameters

| Parameters                                | Detail                                                                                                               |
| :---------------------------------------- | :------------------------------------------------------------------------------------------------------------------- |
| `state`                                   | - ì‘ì—…ì´ ì§„í–‰ ì¤‘ì´ì§€ ì•Šì„ ë•Œ ë°˜í™˜ë  ê°’ì„ ì˜ë¯¸í•©ë‹ˆë‹¤..                                                                |
| `updateFn(currentState, optimisticValue)` | - í˜„ì¬ ìƒíƒœì™€ addOptimisticì— ì „ë‹¬ëœ ë‚™ê´€ì ì¸ ê°’ì„ ì·¨í•˜ëŠ” í•¨ìˆ˜ë¡œ í•´ë‹¹ ì½œë°± í•¨ìˆ˜ë¡œ ì–»ì„ ìˆ˜ ìˆëŠ” ê²°ê³¼ ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤. |

ë§Œì•½ TodoListë¥¼ ë§Œë“ ë‹¤ê³  í•œë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```typescript
import { useOptimistic } from 'react';

// todoListë¥¼ propsë¡œ ë¶ˆëŸ¬ì™€ì„œ ì‚¬ìš©ì„ í•©ë‹ˆë‹¤.
function TodoContainer(todoList:TodoType[]) {
  const [optimisticTodoList, optimisticAddTodo] = useOptimistic(
    // ë¶ˆëŸ¬ì˜¨ todoListë¥¼ ì „ë‹¬í•´ì¤ë‹ˆë‹¤.
    todoList,
    (prevTodoList, newTodoList) => {
      return [...prevTodoList, newTodoList]
    }
  );

  const onSubmit = async (e) => {
    e.preventDefault();

    // ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¥¼ ì‹œë„í•˜ëŠ” í•¨ìˆ˜
    optimisticAddTodo(newTodo)

    // ì‹¤ì œë¡œ ë°ì´í„°ë¥¼ ìš”ì²­í•˜ëŠ” í•¨ìˆ˜
    await addTodo(newTodo)
  }

  return (
    <div>
      <ul>
        {optimisticTodoList.map(todo => {
          <li>{...}</li>
        })}
      </ul>
      <form onSubmit={onSubmit}>
        {...}
      </form>
    </div>
  )
}
```

### ğŸ§ ì‹¤ì œë¡œëŠ” ì–´ë–»ê²Œ ì‚¬ìš©í• ê¹Œìš”?

ì•„ë˜ëŠ” Next.js + TypeScriptë¥¼ ì´ìš©í•˜ì—¬ ë§Œë“  TodoListì…ë‹ˆë‹¤.

ì•„ë˜ ì½”ë“œëŠ” ìµœìƒìœ„ ì½”ë“œë¡œì„œ `todoList`ë¥¼ ë°›ì•„ì™€ì„œ `TodoList`ë¡œ ì „ë‹¬í•´ ì£¼ëŠ” ì—­í• ì„ í•˜ê³  ìˆìŠµë‹ˆë‹¤.

```typescript
// Page

export default async function Home() {
  const res = await fetch('http://localhost:3000/apis/todo', {
    cache: 'no-cache',
    next: {
      tags: ['todo'],
    },
  });

  const todoList = await res.json();

  return (
    <main className="w-full h-screen flex justify-center gap-4 items-center">
      <TodoList todoList={todoList} />
    </main>
  );
}
```

ì•„ë˜ ì½”ë“œì—ì„œëŠ” ì „ë‹¬ë°›ì€ `todoList`ë¥¼ `useOptimistic`ì˜ íŒŒë¼ë¯¸í„° ê°’ìœ¼ë¡œ ì „ë‹¬í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.

ë˜í•œ ì½œë°± í•¨ìˆ˜ë¥¼ í†µí•´ì„œ `addOptimisticAddTodo`ê°€ ì‹¤í–‰ë˜ì—ˆì„ ê²½ìš° ë³´ì¼ `optimisticTodo`ì˜ ëª¨ìŠµì„ ì •ì˜í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.

```typescript
// TodoList

'use client';

type Props = {
  todoList: TodoType[];
};

export default function TodoList({ todoList }: Props) {
  const [optimisticTodo, addOptimisticAddTodo] = useOptimistic<TodoType[], TodoType>(
    todoList,
    (state, newTodo) => [...state, newTodo]
  );

  const onSubmit = async (formData: FormData) => {
    const title = formData.get('title')?.toString();
    const content = formData.get('content')?.toString();

    if (!title || !content) return console.log('is Empty');

    const newTodo: TodoType = {
      content,
      title,
    };

    addOptimisticAddTodo(newTodo);
    await addTodo(newTodo);
  };

  return (
    ...
  );
}

```

ì‹¤ì œ í˜¸ì¶œ í•¨ìˆ˜ì¸ `addTodo`ê°€ í˜¸ì¶œì´ ëœë‹¤ë©´ `revalidateTag`ë¥¼ í†µí•´ ë‹¤ì‹œ `todoList`ë¥¼ í˜¸ì¶œ í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„í•´ë‘ì—ˆìŠµë‹ˆë‹¤.

```typescript
// addTodo

'use server';

import { revalidateTag } from 'next/cache';
import { TodoType } from '../components/TodoList/types/todo.type';

export const addTodo = async (newTodo: TodoType) => {
  await fetch('http://localhost:3000/apis/todo', {
    method: 'POST',
    cache: 'no-cache',
    body: JSON.stringify(newTodo),
    headers: {
      'Content-type': 'application/json',
    },
  });

  revalidateTag('todo');
};
```

ì˜ˆì‹œë¥¼ ë³´ì—¬ì£¼ê¸° ìœ„í•´ì„œ `TodoTypes`ì˜ ê°’ì„ ë°”ê¿” ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.

```typescript
export type TodoType = {
  title: string;
  content: string;
  sending?: boolean;
};

export default function TodoList({ todoList }: Props) {
  const [optimisticTodos, addOptimisticTodos] = useOptimistic(todos, (state, newTodo) => [
    ...state,
    {
      ...newTodo,
      // addOptimisticTodosë¥¼ í†µí•´ ê°’ì´ ì—…ë°ì´íŠ¸ê°€ ë  ë™ì•ˆì—ë§Œ ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¥¼ í†µí•´ sendingì´ trueê°€ ë©ë‹ˆë‹¤.
      // ì‹¤ì œ ë°ì´í„°ì˜ ê²½ìš°ì—ëŠ” sendingì´ë¼ëŠ” ê°’ ìì²´ê°€ ì—†ìŠµë‹ˆë‹¤.
      sending: true,
    },
  ]);

  return (
    <ul>
      {optimisticTodo.map((todo, index) => (
        <li key={'todo' + index}>
          <div>ì œëª©: {todo.title}</div>
          <div>í• ì¼: {todo.content}</div>
          // ë°›ì•„ì˜¨ ë°ì´í„° ì¤‘ sendingì´ë¼ëŠ” ê°’ì´ ìˆì„ ê²½ìš°ì—ëŠ” ì „ì†¡ ì¤‘ì´ë¼ëŠ” ë¬¸êµ¬ê°€ ë³´ì—¬ì§€ê²Œ ë©ë‹ˆë‹¤.
          // ë‚™ê´€ì  ì—…ë°ì´íŠ¸ (Data Fetching)ë¥¼ í•˜ê³  ìˆì„ë•Œë§Œ ìˆëŠ” ì†ì„± ê°’ì…ë‹ˆë‹¤.
          <div>{todo?.sending && 'ì „ì†¡ ì¤‘'}</div>
        </li>
      ))}
    </ul>
  );
}
```

### ğŸ” References

- [React.dev - useOptimistic](https://www.google.com/search?q=useOptimistic&oq=useOptimistic&gs_lcrp=EgZjaHJvbWUqBggAEEUYOzIGCAAQRRg7MgcIARAAGIAEMgcIAhAAGIAEMgcIAxAAGIAEMgYIBBAAGB4yBggFEEUYPDIGCAYQRRg8MgYIBxBFGDzSAQczNjBqMGo0qAIAsAIA&sourceid=chrome&ie=UTF-8)
- [Learn the useOptimistic Hook in 19 minutes](https://www.youtube.com/watch?v=wg3xQogkZDA&t=590s)
- [React í›…: 'useOptimistic'](https://velog.io/@kimkanu/React-%ED%9B%85-useOptimistic)
