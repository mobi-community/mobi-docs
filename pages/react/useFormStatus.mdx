## ✨ `useFormStatus`

> ⚠️ CANARY!

- 해당 기능은 아직 React의 Canary/Experimental 채널에서만 사용 가능합니다.

### 📑 Summary

`useFormStatus`란 가장 마지막 `form` 제출의 상태 정보를 제공하는 훅 함수입니다.

```js
const { pending, data, method, action } = useFormStatus();
```

### 📢 사용 시 주의할 점

- `useFormStatus` 훅 함수는 `form` 요소 내부에 렌더링 되는 컴포넌트에서 호출되어야 합니다.
- `useFormStatus`는 부모 `form` 요소의 상태 정보만을 반환합니다.
  - 동일한 컴포넌트 혹은 자식 컴포넌트에서 렌더링 되는 `form` 요소의 상태에 대한 정보는 반환하지 못합니다.

### 🤔 어떻게 사용할 수 있을까요?

- `useFormStatus`는 마지막 `form` 제출의 상태 정보를 제공합니다.
- 이 훅 함수는 `form`의 제출 행위가 진행 중인지 여부를 알려주는 `pending` 속성과 같은 정보를 반환합니다.

```ts
import { useFormStatus } from "react-dom";
import action from "./actions";

// 상태 정보를 받으려면 해당 컴포넌트는 반드시 `form` 태그 내부에서 렌더링되어야 합니다.
function Submit() {
  const status = useFormStatus();
  // form이 제출 중이라면 button을 disabled 시키기 위해 상태 정보를 사용합니다.
  return <button disabled={status.pending}>Submit</button>;
}

export default function App() {
  return (
    <form action={action}>
      <Submit />
    </form>
  );
}
```

> Parameters

- `useFormStatus`는 별도의 매개 변수를 요구하지 않습니다.

> 반환값

- `status` 객체는 아래의 속성들을 가집니다.

1. `pending`

- **_boolean_**
- 참이라면, 부모 `form` 요소가 제출 대기 중임을 의미합니다.
- 제출 대기 중이 아니라면, 거짓을 반환합니다.

2. `data` (object)

- 부모 `form` 요소가 제출 중인 데이터를 포함한 [FormData](https://developer.mozilla.org/en-US/docs/Web/API/FormData) 인터페이스를 구현하는 객체입니다.
- 만약 활성화된 제출 또는 부모 `form` 요소가 없다면 `null`이 됩니다.

```
🌿 FormData 간단하게 알고 넘어가기
- FormData란 폼을 쉽게 보내도록 도와주는 객체입니다.
- FormData 인터페이스는 fetch(), XMLHttpRequest.send(), navigator.sendBeacon() 메소드를 사용하여 전송할 수 있는
  form 필드와 해당 값을 나타내는 키/값 쌍의 집합을 구성하는 방법을 제공합니다.
```

3. `method`

- `get` 또는 `post`가 될 수 있습니다.
- 부모 `form` 요소가 HTTP 메서드 중 `GET`과 `POST` 중에서 무엇을 사용하여 제출 중인지를 나타냅니다.
- 기본 값으로 `form` 요소는 `GET` 메서드를 사용하게 되며, `method` 속성을 사용하여 특정해줄 수 있습니다.

```
🌿 HTTP 메서드 GET과 POST 간단하게 알고 넘어가기
: HTTP는 주어진 리소스에 대해 수행해야 할 작업을 나타내는 일련의 request 메서드들을 정의하고 있습니다.

🌟 GET
- 지정된 리소스에 대한 표현을 요청합니다.
- GET을 사용한 요청은 오직 데이터 조회만 할 수 있습니다.

🌟 POST
- 지정된 리소스에 엔티티를 제출합니다.
- 보통 서버의 상태 변화 또는 부수 효과를 일으킵니다.
```

4. `action`

- 사용자 입력을 처리하기 위해 부모 컴포넌트에서 자식 컴포넌트인 `form` 요소로 전달되는 함수에 대한 참조입니다.
- 부모 `form`이 없다면 해당 속성은 `null`이 됩니다.
- 만약 `action`에 URI 값이 제공되거나 `action` 값이 특정되지 않는다면 `status.action`은 `null`이 됩니다.

```
🌿 URI 값 간단하게 알고 넘어가기

🌟 URI (Uniform Resource Identifier)
- 통합 자원 식별자
- 인터넷 상의 리소스 '자원 자체'를 식별하는 고유한 문자열 시퀀스

🤔 URL과 무엇이 다를까?
- URL(Uniform Resource Locator)
  - 네트워크 상에서 통합 자원(리소스)의 '위치'를 나타내기 위한 규약
  - 자원 식별자와 위치를 동시에 보여준다. (웹 사이트 주소 + 네트워크 상 자원)
  - 특정 웹 페이지의 주소에 접근하기 위해 필요한 프로토콜까지 모두 나타낸다.
- URI = 식별자 ↔️ URL = 식별자 + 위치
- 예: github.com(URI) ↔️ https://github.com(URL)
```

### 🧐 언제 사용할 수 있을까요?

#### 📍 `form` 제출 중 `pending` 상태 보여주기

- `form`이 제출되고 있는 중에 `pending` 상태를 보여주기 위해 `form` 요소 내부에서 렌더링 되는 컴포넌트 안에 `useFormStatus` 훅 함수를 호출하고 반환되는 `pending` 속성을 읽어올 수 있습니다.

```js
import { useFormStatus } from "react-dom";
import { submitForm } from "./actions.js"; // submit 될 경우 실행할 함수를 구현하여 전달할 수 있습니다.

function Submit() {
  // pending으로 구조분해할당하여 사용합니다.
  // 첫 번째 예시처럼 status 변수에 담은 뒤 status.pending으로 사용할 수도 있습니다.
  const { pending } = useFormStatus();
  // pending 상태일 때는 제출 중임을 나타내는 텍스트를 보여주면서 disabled 되도록 처리할 수 있습니다.
  return (
    <button type='submit' disabled={pending}>
      {pending ? "제출 중..." : "제출하기"}
    </button>
  );
}

function Form({ action }) {
  // useFormStatus가 호출된 컴포넌트는 반드시 form 요소 내부에 위치해야 합니다.
  return (
    <form action={action}>
      <Submit />
    </form>
  );
}

// action 함수를 전달합니다. useFormStatus가 호출된 부분에서 status.action으로 참조할 수 있습니다.
export default function App() {
  return <Form action={submitForm} />;
}
```

#### 📍 제출 되고 있는 `form` 데이터 읽기

- `useFormStatus`에서 반환되는 상태 정보의 `data` 속성을 사용하여 사용자에 의해 제출되고 있는 데이터가 무엇인지 보여줄 수 있습니다.

- 아래의 예시는 사용자 정보를 요청하는 `form` 요소입니다.
  - 이때 `useFormStatus`를 사용하여 요청된 정보를 확인하는 임시 상태 메시지를 표시할 수 있습니다.

> `userDataForm.js`

```js
import { useState, useMemo, useRef } from "react";
import { useFormStatus } from "react-dom";

export default function UserDataForm() {
  const { pending, data } = useFormStatus();

  return (
    <div>
      <h3>Request a Data of: </h3>
      <input type='text' name='userId' disabled={pending} />
      <button type='submit' disabled={pending}>
        제출하기
      </button>
      <br />
      <p>{data ? `${data?.get("userId")}에 대한 정보 요청 중...` : ""}</p>
    </div>
  );
}
```

> `App.js`

```ts
import UsernameForm from "./UsernameForm";
import { submitForm } from "./actions.js";
import { useRef } from "react";

export default function App() {
  const ref = useRef(null);

  // 사용자 정보를 입력하는 form 제출 시 submitForm 함수가 호출되어 데이터를 서버로 제출하고 form은 초기화됩니다.
  const submitData = async (formData: FormData) => {
    // 비동기적으로 formData를 제출합니다.
    await submitForm(formData);
    // form 요소에 대한 참조(ref)를 사용하여 form 요소에 입력된 값을 모두 초기화합니다.
    ref.current.reset();
  };

  return (
    <form ref={ref} action={submitData}>
      <UserDataForm />
    </form>
  );
}
```

### 🚨 Troubleshooting

> `useFormStatus`가 `form` 요소의 자식 컴포넌트에서 호출되었는지 확인하세요!

- `useFormStatus`는 부모 `form` 요소에 대한 상태 정보만을 반환합니다.
- 따라서 만약 `useFormStatus`를 호출하는 컴포넌트가 `form` 요소로 감싸져있지 않다면 `status.pending`은 항상 `false` 값만을 반환하게 될 것입니다.

> `useFormStatus`는 동일한 컴포넌트에서 렌더링 되는 `form` 요소의 상태 정보를 반환하지 않습니다!

- `useFormStatus` 훅 함수는 오직 부모 `form` 요소의 상태 정보만을 반환하므로, `form` 요소 안에 있는 컴포넌트 내부에서 `useFormStatus`를 호출하세요.

```ts
// 🚩 `pending`이 절대 참이 될 수 없는 경우
function WrongForm() {
  // useFormStatus는 이 컴포넌트에서 렌더링되는 form 요소를 추적하지 못하게 됩니다.
  const { pending } = useFormStatus();
  return <form action={submit}></form>;
}

// ✅ `pending` 값이 Submit 컴포넌트를 감싸는 form 요소에서 파생됩니다.
function Submit() {
  const { pending } = useFormStatus();
  return <button disabled={pending}>...</button>;
}

function CorrectForm() {
  // useFormStatus가 추적하게 될 form 요소입니다.
  return (
    <form action={submit}>
      <Submit />
    </form>
  );
}
```

### 🔎 References

- [React.dev - useFormStatus](https://react.dev/reference/react-dom/hooks/useFormStatus)
- [New client-side hooks coming to React 19](https://marmelab.com/blog/2024/01/23/react-19-new-hooks.html)
- [FormData](https://developer.mozilla.org/en-US/docs/Web/API/FormData)
- [HTTP request methods](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods)
- [URI와 URL, 어떤 차이점이 있나요?](https://www.elancer.co.kr/blog/view?seq=74)
